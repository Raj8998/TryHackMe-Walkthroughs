# Exploiting SMB
> Raj Pastagiya | 05/11/2023

### Types of SMB Exploits
- While there are vulnerabilities such as [CVE-2017-7494](https://www.cvedetails.com/cve/CVE-2017-7494/) that can allow remote code execution by exploiting SMB, you're more likely to encounter a situation where the best way into a system is due to misconfigurations in the system.
### Method Breakdown for common misconfiguration
- Enumerate:
	- The SMB share location
	- The name of an interesting SMB share

### SMBClient - A tool for Enumeration as well as to connect to SMB shares
- Because we're trying to access an SMB share, we need a client to access resources on servers, which is where SMBClient comes into picture.
- Syntax: `smbclient //[IP]/[SHARE]`
	- Note another syntax can be `smbclient ////[IP]//[SHARE]` (Mainly if "/" is considered as special character in your command line)
- Useful Arguments:
	- "-U": Specify custom username
	- "-p": Specify Custom Port
- Start with checking as "Anonymous" user, and see if it is allowed. This is a common misconfiguration for SMB.

# Quiz Section
- What would be the correct syntax to access an SMB share called "secret" as user "suit" on a machine with the IP 10.10.10.2 on the default port?
> smbclient //10.10.10.2/secret -U suit -p 445

- Does the share "profile" allow anonymous access? Y/N?
> **Answer:** Y
> **Command to Run:** `smbclient //ip/profiles`

- Great! Have a look around for any interesting documents that could contain valuable information. Who can we assume this profile folder belongs to?
> Name of interesting document: 'Working From Home Information.txt'
> **Answer:** John Cactus

- What service has been configured to allow him to work from home?
> **Answer:** SSH

- Okay! Now we know this, what directory on the share should we look in?
> **Answer:** .ssh

- This directory contains authentication keys that allow a user to authenticate themselves on, and then access, a server. Which of these keys is most useful to us?
> **Answer:** id_rsa

- Login with given information and get the flag.
> **Answer:** THM{smb_is_fun_eh?}
> **Command to Run:** `ssh -i id_rsa cactus@$ip`